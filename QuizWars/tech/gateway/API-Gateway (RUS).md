#quizwars #gateway #go #grpc #http #websocket 

**Ссылка**: [GitHub](https://github.com/QuizWars-Ecosystem/api-gateway)

Gateway выполняет роль посредника между клиентами и сервисами внутри периметра. Он является  точкой входа запросов. Он так же отслеживает все сервисы и их адреса и занимается балансировкой запросов. 

Так как основной формат общения у нас явиться *gRPC*, наш gateway принимает запросы на *grpc-port* и перенаправляет их на те адреса здоровые на которые был адресован запрос. 
#### Consul

Важно понимать что сам gateway не проверяет здоровье сервисов, это делает *Consul*. Когда какой либо из сервисов готов к работе. Он регистрирует себя в реестре *Consul* и передает свой адрес и порт что бы тот мог иногда проверять состояние сервиса. Когда сервис падает либо корректно завершается, *Consul* убирает его из списка здоровых сервисов что бы *Gateway* ненароком не отправил на адрес уже не рабочего инстанса. 

Список активных сервисов можно посмотреть в панели управления *Consul*. Найти ее можно перейдя на внешний адрес запущенного контейнера. Обычно это *http://localhost:8555*, для уточнения посмотрите порт в [[Server Table# Default ports table]] либо прямо у запущенного контейнера. 

![[Pasted image 20250421231254.png]]

 Тут мы видим один инстанс *Consul* и два сервиса который тоже в количестве одного инстанса. 

Мы может перейти глубже нажав на какой либо из сервисов и посмотреть о нем более детальную информацию.

![[Pasted image 20250421231611.png]]

Тут отображается список инстансов данного сервиса, его адрес, теги и также состояние его здоровья. Каждые N время, *Consul* отправляет запрос к сервисам что бы узнать, в состоянии ли они работать, и если да то обновляет их данные у себя. Если же нет, то через время он попытается несколько раз еще. В конце концов он просто уберет данный инстанс из списка рабочих.

Сам *Gateway* отслеживает рабочие адреса сервисов через *Consul plan*. *Plan* это подписка на событие, наш *gateway* подписывает на нужные ему адреса, и если какие-то изменения в нужных ему адресах происходят, к примеру был добавлен новый инстанс сервиса, то тот добавляет его адрес в свой список что бы балансировать запросы между этим списком.  